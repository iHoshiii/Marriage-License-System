[
  {
    "table_name": "addresses",
    "columns": [
      {
        "column": "barangay",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "province",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "created_at",
        "type": "timestamptz",
        "nullable": "YES"
      },
      {
        "column": "municipality",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "street_address",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "id",
        "type": "uuid",
        "nullable": "NO"
      }
    ],
    "policies": [
      {
        "name": "addresses_select_final",
        "command": "SELECT",
        "roles": [
          "anon",
          "authenticated"
        ],
        "using": "true",
        "check": null
      },
      {
        "name": "addresses_insert_authenticated_only",
        "command": "INSERT",
        "roles": [
          "authenticated"
        ],
        "using": null,
        "check": "true"
      }
    ],
    "foreign_keys": []
  },
  {
    "table_name": "applicants",
    "columns": [
      {
        "column": "updated_at",
        "type": "timestamptz",
        "nullable": "YES"
      },
      {
        "column": "mother_citizenship",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "mother_name",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "father_citizenship",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "father_name",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "phone_number",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "citizenship",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "religion",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "last_name",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "middle_name",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "application_id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "first_name",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "birth_date",
        "type": "date",
        "nullable": "YES"
      },
      {
        "column": "age",
        "type": "int4",
        "nullable": "YES"
      },
      {
        "column": "address_id",
        "type": "uuid",
        "nullable": "YES"
      },
      {
        "column": "type",
        "type": "varchar",
        "nullable": "YES"
      },
      {
        "column": "suffix",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "created_at",
        "type": "timestamptz",
        "nullable": "YES"
      }
    ],
    "policies": [
      {
        "name": "applicants_insert_authenticated_only",
        "command": "INSERT",
        "roles": [
          "authenticated"
        ],
        "using": null,
        "check": "true"
      },
      {
        "name": "applicants_select_final",
        "command": "SELECT",
        "roles": [
          "anon",
          "authenticated"
        ],
        "using": "true",
        "check": null
      }
    ],
    "foreign_keys": [
      {
        "column": "application_id",
        "references_table": "marriage_applications",
        "references_column": "id"
      },
      {
        "column": "address_id",
        "references_table": "addresses",
        "references_column": "id"
      }
    ]
  },
  {
    "table_name": "application_photos",
    "columns": [
      {
        "column": "file_path",
        "type": "text",
        "nullable": "NO"
      },
      {
        "column": "id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "application_id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "file_size",
        "type": "int4",
        "nullable": "NO"
      },
      {
        "column": "uploaded_by",
        "type": "uuid",
        "nullable": "YES"
      },
      {
        "column": "uploaded_at",
        "type": "timestamptz",
        "nullable": "YES"
      },
      {
        "column": "photo_type",
        "type": "varchar",
        "nullable": "NO"
      }
    ],
    "policies": [
      {
        "name": "employees_manage_application_photos",
        "command": "ALL",
        "roles": [
          "authenticated"
        ],
        "using": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND ((profiles.role)::text = ANY ((ARRAY['employee'::character varying, 'admin'::character varying])::text[])))))",
        "check": null
      }
    ],
    "foreign_keys": [
      {
        "column": "application_id",
        "references_table": "marriage_applications",
        "references_column": "id"
      },
      {
        "column": "uploaded_by",
        "references_table": "profiles",
        "references_column": "id"
      }
    ]
  },
  {
    "table_name": "audit_logs",
    "columns": [
      {
        "column": "action",
        "type": "text",
        "nullable": "NO"
      },
      {
        "column": "id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "details",
        "type": "jsonb",
        "nullable": "YES"
      },
      {
        "column": "user_id",
        "type": "uuid",
        "nullable": "YES"
      },
      {
        "column": "created_at",
        "type": "timestamptz",
        "nullable": "YES"
      },
      {
        "column": "application_id",
        "type": "uuid",
        "nullable": "YES"
      }
    ],
    "policies": [
      {
        "name": "authenticated_insert_audit_logs",
        "command": "INSERT",
        "roles": [
          "authenticated"
        ],
        "using": null,
        "check": "true"
      },
      {
        "name": "admins_view_audit_logs",
        "command": "SELECT",
        "roles": [
          "authenticated"
        ],
        "using": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND ((profiles.role)::text = 'admin'::text))))",
        "check": null
      }
    ],
    "foreign_keys": [
      {
        "column": "application_id",
        "references_table": "marriage_applications",
        "references_column": "id"
      },
      {
        "column": "user_id",
        "references_table": "profiles",
        "references_column": "id"
      }
    ]
  },
  {
    "table_name": "generated_documents",
    "columns": [
      {
        "column": "file_path",
        "type": "text",
        "nullable": "NO"
      },
      {
        "column": "id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "application_id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "file_size",
        "type": "int4",
        "nullable": "NO"
      },
      {
        "column": "generated_by",
        "type": "uuid",
        "nullable": "YES"
      },
      {
        "column": "generated_at",
        "type": "timestamptz",
        "nullable": "YES"
      }
    ],
    "policies": [
      {
        "name": "employees_manage_documents",
        "command": "ALL",
        "roles": [
          "authenticated"
        ],
        "using": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND ((profiles.role)::text = ANY ((ARRAY['employee'::character varying, 'admin'::character varying])::text[])))))",
        "check": null
      }
    ],
    "foreign_keys": [
      {
        "column": "application_id",
        "references_table": "marriage_applications",
        "references_column": "id"
      },
      {
        "column": "generated_by",
        "references_table": "profiles",
        "references_column": "id"
      }
    ]
  },
  {
    "table_name": "marriage_applications",
    "columns": [
      {
        "column": "created_by",
        "type": "uuid",
        "nullable": "YES"
      },
      {
        "column": "document_number",
        "type": "int4",
        "nullable": "YES"
      },
      {
        "column": "id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "contact_number",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "status",
        "type": "varchar",
        "nullable": "YES"
      },
      {
        "column": "application_code",
        "type": "varchar",
        "nullable": "NO"
      },
      {
        "column": "updated_at",
        "type": "timestamptz",
        "nullable": "YES"
      },
      {
        "column": "created_at",
        "type": "timestamptz",
        "nullable": "YES"
      },
      {
        "column": "processed_by",
        "type": "uuid",
        "nullable": "YES"
      }
    ],
    "policies": [
      {
        "name": "users_update_own_application_contact",
        "command": "UPDATE",
        "roles": [
          "authenticated"
        ],
        "using": "(created_by = auth.uid())",
        "check": "(created_by = auth.uid())"
      },
      {
        "name": "staff_update_access",
        "command": "UPDATE",
        "roles": [
          "public"
        ],
        "using": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND ((profiles.role)::text = ANY ((ARRAY['admin'::character varying, 'employee'::character varying])::text[])))))",
        "check": null
      },
      {
        "name": "service_role_full_access",
        "command": "ALL",
        "roles": [
          "public"
        ],
        "using": "(auth.role() = 'service_role'::text)",
        "check": null
      },
      {
        "name": "Staff can view all marriage applications",
        "command": "SELECT",
        "roles": [
          "authenticated"
        ],
        "using": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND ((profiles.role)::text = ANY ((ARRAY['admin'::character varying, 'employee'::character varying])::text[])))))",
        "check": null
      },
      {
        "name": "service_role_unrestricted",
        "command": "ALL",
        "roles": [
          "public"
        ],
        "using": "(auth.role() = 'service_role'::text)",
        "check": null
      },
      {
        "name": "admin_employee_update",
        "command": "UPDATE",
        "roles": [
          "public"
        ],
        "using": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND ((profiles.role)::text = ANY ((ARRAY['admin'::character varying, 'employee'::character varying])::text[])))))",
        "check": null
      },
      {
        "name": "app_insert_authenticated",
        "command": "INSERT",
        "roles": [
          "authenticated"
        ],
        "using": null,
        "check": "(created_by = auth.uid())"
      },
      {
        "name": "enforce_one_app_claim",
        "command": "UPDATE",
        "roles": [
          "authenticated"
        ],
        "using": "(created_by IS NULL)",
        "check": "((created_by = auth.uid()) AND (NOT (EXISTS ( SELECT 1\n   FROM marriage_applications marriage_applications_1\n  WHERE (marriage_applications_1.created_by = auth.uid())))))"
      },
      {
        "name": "users_view_own_applications",
        "command": "SELECT",
        "roles": [
          "authenticated"
        ],
        "using": "(created_by = auth.uid())",
        "check": null
      },
      {
        "name": "allow_authenticated_view_unclaimed",
        "command": "SELECT",
        "roles": [
          "authenticated"
        ],
        "using": "(created_by IS NULL)",
        "check": null
      }
    ],
    "foreign_keys": [
      {
        "column": "created_by",
        "references_table": "profiles",
        "references_column": "id"
      },
      {
        "column": "processed_by",
        "references_table": "profiles",
        "references_column": "id"
      }
    ]
  },
  {
    "table_name": "notifications",
    "columns": [
      {
        "column": "user_id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "metadata",
        "type": "jsonb",
        "nullable": "YES"
      },
      {
        "column": "read_at",
        "type": "timestamptz",
        "nullable": "YES"
      },
      {
        "column": "title",
        "type": "text",
        "nullable": "NO"
      },
      {
        "column": "message",
        "type": "text",
        "nullable": "NO"
      },
      {
        "column": "type",
        "type": "text",
        "nullable": "NO"
      },
      {
        "column": "created_at",
        "type": "timestamptz",
        "nullable": "YES"
      },
      {
        "column": "created_by",
        "type": "uuid",
        "nullable": "YES"
      },
      {
        "column": "related_user_id",
        "type": "uuid",
        "nullable": "YES"
      },
      {
        "column": "related_application_id",
        "type": "uuid",
        "nullable": "YES"
      },
      {
        "column": "id",
        "type": "uuid",
        "nullable": "NO"
      }
    ],
    "policies": [
      {
        "name": "users_view_own_notifications",
        "command": "SELECT",
        "roles": [
          "public"
        ],
        "using": "(auth.uid() = user_id)",
        "check": null
      },
      {
        "name": "staff_view_created_notifications",
        "command": "SELECT",
        "roles": [
          "public"
        ],
        "using": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND ((profiles.role)::text = ANY ((ARRAY['admin'::character varying, 'employee'::character varying])::text[])))))",
        "check": null
      },
      {
        "name": "authenticated_insert_notifications",
        "command": "INSERT",
        "roles": [
          "public"
        ],
        "using": null,
        "check": "(auth.uid() IS NOT NULL)"
      },
      {
        "name": "users_update_own_notifications",
        "command": "UPDATE",
        "roles": [
          "public"
        ],
        "using": "(auth.uid() = user_id)",
        "check": null
      }
    ],
    "foreign_keys": [
      {
        "column": "related_application_id",
        "references_table": "marriage_applications",
        "references_column": "id"
      }
    ]
  },
  {
    "table_name": "profiles",
    "columns": [
      {
        "column": "created_at",
        "type": "timestamptz",
        "nullable": "YES"
      },
      {
        "column": "id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "phone_number",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "employee_id",
        "type": "varchar",
        "nullable": "YES"
      },
      {
        "column": "full_name",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "role",
        "type": "varchar",
        "nullable": "NO"
      },
      {
        "column": "updated_at",
        "type": "timestamptz",
        "nullable": "YES"
      }
    ],
    "policies": [
      {
        "name": "profiles_select_policy",
        "command": "SELECT",
        "roles": [
          "public"
        ],
        "using": "((auth.uid() = id) OR is_admin_or_employee())",
        "check": null
      },
      {
        "name": "profiles_update_policy",
        "command": "UPDATE",
        "roles": [
          "public"
        ],
        "using": "((auth.uid() = id) OR is_admin_or_employee())",
        "check": null
      },
      {
        "name": "profiles_insert_policy",
        "command": "INSERT",
        "roles": [
          "public"
        ],
        "using": null,
        "check": "(auth.uid() = id)"
      }
    ],
    "foreign_keys": []
  },
  {
    "table_name": "user_document_uploads",
    "columns": [
      {
        "column": "uploaded_at",
        "type": "timestamptz",
        "nullable": "YES"
      },
      {
        "column": "file_path",
        "type": "text",
        "nullable": "NO"
      },
      {
        "column": "uploaded_by",
        "type": "uuid",
        "nullable": "YES"
      },
      {
        "column": "file_size",
        "type": "int4",
        "nullable": "NO"
      },
      {
        "column": "file_name",
        "type": "text",
        "nullable": "NO"
      },
      {
        "column": "application_id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "document_type",
        "type": "varchar",
        "nullable": "NO"
      }
    ],
    "policies": [
      {
        "name": "employees_view_all_documents",
        "command": "SELECT",
        "roles": [
          "authenticated"
        ],
        "using": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND ((profiles.role)::text = ANY ((ARRAY['employee'::character varying, 'admin'::character varying])::text[])))))",
        "check": null
      },
      {
        "name": "users_manage_own_documents",
        "command": "ALL",
        "roles": [
          "authenticated"
        ],
        "using": "(uploaded_by = auth.uid())",
        "check": null
      }
    ],
    "foreign_keys": [
      {
        "column": "uploaded_by",
        "references_table": "profiles",
        "references_column": "id"
      },
      {
        "column": "application_id",
        "references_table": "marriage_applications",
        "references_column": "id"
      }
    ]
  }
]