[
  {
    "table_name": "addresses",
    "columns": [
      {
        "column": "street_address",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "barangay",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "province",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "created_at",
        "type": "timestamptz",
        "nullable": "YES"
      },
      {
        "column": "municipality",
        "type": "text",
        "nullable": "YES"
      }
    ],
    "policies": [
      {
        "name": "allow_anon_address_insert",
        "command": "INSERT",
        "roles": [
          "anon",
          "authenticated"
        ],
        "using": null,
        "check": "true"
      },
      {
        "name": "public_read_addresses",
        "command": "SELECT",
        "roles": [
          "anon"
        ],
        "using": "true",
        "check": null
      },
      {
        "name": "addresses_view_policy",
        "command": "SELECT",
        "roles": [
          "authenticated"
        ],
        "using": "(EXISTS ( SELECT 1\n   FROM (applicants\n     JOIN marriage_applications ON ((marriage_applications.id = applicants.application_id)))\n  WHERE ((applicants.address_id = addresses.id) AND ((marriage_applications.created_by = auth.uid()) OR is_admin_or_employee()))))",
        "check": null
      },
      {
        "name": "authenticated_create_addresses",
        "command": "INSERT",
        "roles": [
          "authenticated"
        ],
        "using": null,
        "check": "true"
      }
    ],
    "foreign_keys": []
  },
  {
    "table_name": "applicants",
    "columns": [
      {
        "column": "id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "application_id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "birth_date",
        "type": "date",
        "nullable": "YES"
      },
      {
        "column": "age",
        "type": "int4",
        "nullable": "YES"
      },
      {
        "column": "address_id",
        "type": "uuid",
        "nullable": "YES"
      },
      {
        "column": "created_at",
        "type": "timestamptz",
        "nullable": "YES"
      },
      {
        "column": "updated_at",
        "type": "timestamptz",
        "nullable": "YES"
      },
      {
        "column": "phone_number",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "citizenship",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "religion",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "middle_name",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "first_name",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "type",
        "type": "varchar",
        "nullable": "YES"
      },
      {
        "column": "suffix",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "last_name",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "mother_citizenship",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "mother_name",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "father_citizenship",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "father_name",
        "type": "text",
        "nullable": "YES"
      }
    ],
    "policies": [
      {
        "name": "applicants_view_as_owner",
        "command": "SELECT",
        "roles": [
          "authenticated"
        ],
        "using": "(EXISTS ( SELECT 1\n   FROM marriage_applications\n  WHERE ((marriage_applications.id = applicants.application_id) AND (marriage_applications.created_by = auth.uid()))))",
        "check": null
      },
      {
        "name": "authenticated_create_applicants",
        "command": "INSERT",
        "roles": [
          "authenticated"
        ],
        "using": null,
        "check": "true"
      },
      {
        "name": "allow_applicant_creation",
        "command": "INSERT",
        "roles": [
          "anon",
          "authenticated"
        ],
        "using": null,
        "check": "true"
      },
      {
        "name": "applicants_view_as_staff",
        "command": "SELECT",
        "roles": [
          "authenticated"
        ],
        "using": "is_admin_or_employee()",
        "check": null
      }
    ],
    "foreign_keys": [
      {
        "column": "application_id",
        "references_table": "marriage_applications",
        "references_column": "id"
      },
      {
        "column": "address_id",
        "references_table": "addresses",
        "references_column": "id"
      }
    ]
  },
  {
    "table_name": "application_photos",
    "columns": [
      {
        "column": "uploaded_at",
        "type": "timestamptz",
        "nullable": "YES"
      },
      {
        "column": "id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "application_id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "file_size",
        "type": "int4",
        "nullable": "NO"
      },
      {
        "column": "uploaded_by",
        "type": "uuid",
        "nullable": "YES"
      },
      {
        "column": "photo_type",
        "type": "varchar",
        "nullable": "NO"
      },
      {
        "column": "file_path",
        "type": "text",
        "nullable": "NO"
      }
    ],
    "policies": [
      {
        "name": "employees_manage_application_photos",
        "command": "ALL",
        "roles": [
          "authenticated"
        ],
        "using": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND ((profiles.role)::text = ANY ((ARRAY['employee'::character varying, 'admin'::character varying])::text[])))))",
        "check": null
      }
    ],
    "foreign_keys": [
      {
        "column": "application_id",
        "references_table": "marriage_applications",
        "references_column": "id"
      },
      {
        "column": "uploaded_by",
        "references_table": "profiles",
        "references_column": "id"
      }
    ]
  },
  {
    "table_name": "audit_logs",
    "columns": [
      {
        "column": "created_at",
        "type": "timestamptz",
        "nullable": "YES"
      },
      {
        "column": "action",
        "type": "text",
        "nullable": "NO"
      },
      {
        "column": "application_id",
        "type": "uuid",
        "nullable": "YES"
      },
      {
        "column": "user_id",
        "type": "uuid",
        "nullable": "YES"
      },
      {
        "column": "id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "details",
        "type": "jsonb",
        "nullable": "YES"
      }
    ],
    "policies": [
      {
        "name": "admins_view_audit_logs",
        "command": "SELECT",
        "roles": [
          "authenticated"
        ],
        "using": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND ((profiles.role)::text = 'admin'::text))))",
        "check": null
      },
      {
        "name": "authenticated_insert_audit_logs",
        "command": "INSERT",
        "roles": [
          "authenticated"
        ],
        "using": null,
        "check": "true"
      }
    ],
    "foreign_keys": [
      {
        "column": "application_id",
        "references_table": "marriage_applications",
        "references_column": "id"
      },
      {
        "column": "user_id",
        "references_table": "profiles",
        "references_column": "id"
      }
    ]
  },
  {
    "table_name": "generated_documents",
    "columns": [
      {
        "column": "id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "generated_at",
        "type": "timestamptz",
        "nullable": "YES"
      },
      {
        "column": "application_id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "file_path",
        "type": "text",
        "nullable": "NO"
      },
      {
        "column": "file_size",
        "type": "int4",
        "nullable": "NO"
      },
      {
        "column": "generated_by",
        "type": "uuid",
        "nullable": "YES"
      }
    ],
    "policies": [
      {
        "name": "employees_manage_documents",
        "command": "ALL",
        "roles": [
          "authenticated"
        ],
        "using": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND ((profiles.role)::text = ANY ((ARRAY['employee'::character varying, 'admin'::character varying])::text[])))))",
        "check": null
      }
    ],
    "foreign_keys": [
      {
        "column": "application_id",
        "references_table": "marriage_applications",
        "references_column": "id"
      },
      {
        "column": "generated_by",
        "references_table": "profiles",
        "references_column": "id"
      }
    ]
  },
  {
    "table_name": "marriage_applications",
    "columns": [
      {
        "column": "document_number",
        "type": "int4",
        "nullable": "YES"
      },
      {
        "column": "created_at",
        "type": "timestamptz",
        "nullable": "YES"
      },
      {
        "column": "processed_by",
        "type": "uuid",
        "nullable": "YES"
      },
      {
        "column": "updated_at",
        "type": "timestamptz",
        "nullable": "YES"
      },
      {
        "column": "application_code",
        "type": "varchar",
        "nullable": "NO"
      },
      {
        "column": "status",
        "type": "varchar",
        "nullable": "YES"
      },
      {
        "column": "id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "created_by",
        "type": "uuid",
        "nullable": "YES"
      }
    ],
    "policies": [
      {
        "name": "allow_anon_application_creation",
        "command": "INSERT",
        "roles": [
          "anon"
        ],
        "using": null,
        "check": "true"
      },
      {
        "name": "users_view_own_applications",
        "command": "SELECT",
        "roles": [
          "authenticated"
        ],
        "using": "(created_by = auth.uid())",
        "check": null
      },
      {
        "name": "employees_update_applications",
        "command": "UPDATE",
        "roles": [
          "authenticated"
        ],
        "using": "check_user_role(ARRAY['employee'::text, 'admin'::text])",
        "check": null
      },
      {
        "name": "allow_authenticated_view_unclaimed",
        "command": "SELECT",
        "roles": [
          "authenticated"
        ],
        "using": "(created_by IS NULL)",
        "check": null
      },
      {
        "name": "users_claim_application",
        "command": "UPDATE",
        "roles": [
          "authenticated"
        ],
        "using": "(created_by IS NULL)",
        "check": "((created_by = auth.uid()) AND (NOT (EXISTS ( SELECT 1\n   FROM marriage_applications marriage_applications_1\n  WHERE ((marriage_applications_1.created_by = auth.uid()) AND (marriage_applications_1.id <> marriage_applications_1.id))))))"
      },
      {
        "name": "anon_view_own_applications",
        "command": "SELECT",
        "roles": [
          "anon"
        ],
        "using": "(created_by IS NULL)",
        "check": null
      },
      {
        "name": "anon_view_by_code",
        "command": "SELECT",
        "roles": [
          "anon"
        ],
        "using": "true",
        "check": null
      },
      {
        "name": "allow_application_creation",
        "command": "INSERT",
        "roles": [
          "authenticated"
        ],
        "using": null,
        "check": "(NOT (EXISTS ( SELECT 1\n   FROM marriage_applications marriage_applications_1\n  WHERE (marriage_applications_1.created_by = auth.uid()))))"
      }
    ],
    "foreign_keys": [
      {
        "column": "created_by",
        "references_table": "profiles",
        "references_column": "id"
      },
      {
        "column": "processed_by",
        "references_table": "profiles",
        "references_column": "id"
      }
    ]
  },
  {
    "table_name": "profiles",
    "columns": [
      {
        "column": "updated_at",
        "type": "timestamptz",
        "nullable": "YES"
      },
      {
        "column": "role",
        "type": "varchar",
        "nullable": "NO"
      },
      {
        "column": "full_name",
        "type": "text",
        "nullable": "YES"
      },
      {
        "column": "employee_id",
        "type": "varchar",
        "nullable": "YES"
      },
      {
        "column": "id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "created_at",
        "type": "timestamptz",
        "nullable": "YES"
      }
    ],
    "policies": [
      {
        "name": "profiles_view_own",
        "command": "SELECT",
        "roles": [
          "authenticated"
        ],
        "using": "(id = auth.uid())",
        "check": null
      },
      {
        "name": "profiles_view_all_as_staff",
        "command": "SELECT",
        "roles": [
          "authenticated"
        ],
        "using": "is_admin_or_employee()",
        "check": null
      },
      {
        "name": "users_view_own_profile",
        "command": "SELECT",
        "roles": [
          "authenticated"
        ],
        "using": "(auth.uid() = id)",
        "check": null
      }
    ],
    "foreign_keys": []
  },
  {
    "table_name": "user_document_uploads",
    "columns": [
      {
        "column": "application_id",
        "type": "uuid",
        "nullable": "NO"
      },
      {
        "column": "file_size",
        "type": "int4",
        "nullable": "NO"
      },
      {
        "column": "file_name",
        "type": "text",
        "nullable": "NO"
      },
      {
        "column": "uploaded_by",
        "type": "uuid",
        "nullable": "YES"
      },
      {
        "column": "uploaded_at",
        "type": "timestamptz",
        "nullable": "YES"
      },
      {
        "column": "document_type",
        "type": "varchar",
        "nullable": "NO"
      },
      {
        "column": "file_path",
        "type": "text",
        "nullable": "NO"
      },
      {
        "column": "id",
        "type": "uuid",
        "nullable": "NO"
      }
    ],
    "policies": [
      {
        "name": "users_manage_own_documents",
        "command": "ALL",
        "roles": [
          "authenticated"
        ],
        "using": "(uploaded_by = auth.uid())",
        "check": null
      },
      {
        "name": "employees_view_all_documents",
        "command": "SELECT",
        "roles": [
          "authenticated"
        ],
        "using": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND ((profiles.role)::text = ANY ((ARRAY['employee'::character varying, 'admin'::character varying])::text[])))))",
        "check": null
      }
    ],
    "foreign_keys": [
      {
        "column": "uploaded_by",
        "references_table": "profiles",
        "references_column": "id"
      },
      {
        "column": "application_id",
        "references_table": "marriage_applications",
        "references_column": "id"
      }
    ]
  }
]